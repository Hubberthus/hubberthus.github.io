<!DOCTYPE html>
<html lang="en">

	<head>
	  <meta charset="utf-8">
	  <meta http-equiv="X-UA-Compatible" content="IE=edge">
	  <meta name="viewport" content="width=device-width, initial-scale=1">
	  <link href="css/bootstrap.min.css" rel="stylesheet" />
	  <link href="css/bootstrap-theme.min.css" rel="stylesheet" />
	  <link href="css/main.css" rel="stylesheet" />
	  <title>MCU setup</title>
	</head>
	
	<body>
	
		<div ng-controller="mcuSetupController" class="container-fluid">
			<div class="row">
				<div class="col-sm-3 panel-group">
					<div class="panel panel-info">
						<div class="panel-heading">Peripherals</div>
						<div class="panel-body" id="peripherals">

							<div ng-repeat="peripheral in core.peripherals" class="panel">

								<div class="panel-heading" style="background: {{peripheral.color}};">
									<h5 class="panel-title collapsed" data-toggle="collapse" href="#collapse{{peripheral.name}}">
										{{peripheral.name}}
										<span class="glyphicon {{(peripheral.enabled ? 'glyphicon-ok' : 'glyphicon-remove')}}"></span>
									</h5>
								</div>
								<div class="panel-collapse collapse" id="collapse{{peripheral.name}}">
									<div>
										{{peripheral.description}}
									</div>
									<div>
										<span class="mode-name">
											Mode
										</span>
										<select ng-model="peripheral.active_mode" class="mode-selector">
											<option ng-repeat="(modename, modepins) in peripheral.modes" value="{{modename}}">{{modename}}</option>
										</select>
									</div>
									
									<div ng-repeat="(pinname, pinnums) in peripheral.pins" style="background: {{($even ? 'white' : 'lightgrey')}};">
										<div ng-if="pinnums.length > 1">
											<span class="pin-name">
												{{pinname}}
											</span>
											<button ng-if="pinnums.length == 2" ng-click="(peripheral.active_pins[pinname] ? peripheral.active_pins[pinname] = null : peripheral.active_pins[pinname] = pinnums[1])" class="btn label {{(peripheral.active_pins[pinname] ? 'label-success' : 'label-default')}} selector">
												{{(peripheral.active_pins[pinname] ? "ON" : "OFF")}}
											</button>
											<select ng-if="pinnums.length > 2" ng-model="peripheral.active_pins[pinname]" class="selector">
												<option ng-repeat="num in pinnums" value="{{num}}">{{(num ? active_module.pin_map[num] : "---")}}</option>
											</select>
										</div>
									</div>
									
									<button ng-click="peripheral.enabled = ! peripheral.enabled" class="btn btn-default" style="{{(peripheral.name == 'GPIO' ? 'display: none;' : '')}};">
										{{(peripheral.enabled ? "disable" : "enable")}}
									</button>
								</div>
							</div>
							
						</div>
					</div>
				</div>
				<div class="col-sm-9" id="module">
				
					<img src="{{active_module.image}}" class="module-image"></img>
					
					<div ng-repeat="pin in active_module.pins" class="label-pin-{{pin.side}}" style="top: {{pin.position}}%;">
						<div ng-if="pin.name" class="label" style="background: {{pin.color}};">
							{{pin.name}}
						</div>
						
						<div ng-if="!pin.name"> 
							<div ng-repeat="peripheral in core.peripherals" style="display:inline-block;">
								<div ng-repeat="peripinname in peripheral.modes[peripheral.active_mode]">
									<span ng-if="(peripheral.active_pins[peripinname] == pin.number) && (peripheral.enabled)" class="label" style="background: {{peripheral.color}};">
										{{peripinname}}
									</span>
								</div>
							</div>
						</div>
					</div>
				
				</div>
			</div>
		
		</div>
		
		<script data-main="config" src="lib/require.js"></script>
	
	</body>
</html>

