<!DOCTYPE html>
<html lang="en">

	<head>
	  <meta charset="utf-8">
	  <meta http-equiv="X-UA-Compatible" content="IE=edge">
	  <meta name="viewport" content="width=device-width, initial-scale=1">
	  <link href="css/bootstrap.min.css" rel="stylesheet" />
	  <link href="css/bootstrap-theme.min.css" rel="stylesheet" />
	  <link href="css/main.css" rel="stylesheet" />
	  <link rel="shortcut icon" href="logo.png" type="image/png"/>
	  <title>MCU pin setup</title>
	</head>
	
	<body>
		<div ng-controller="mcuSetupController" class="container-fluid">
		
			<div class="loading" style="{{(active_module ? 'display: none;' : '')}}">
				<h1 style="margin: 2em;">
					Loading page...
				</h1>
			</div>
		
			<nav class="navbar navbar-default">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#collapse-navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a href="/index.html"><img class="btn navbar-brand" style="padding: 2px;" src="logo.png"></img></a>
				
				<div class="collapse navbar-collapse" id="collapse-navbar">
					<div class="navbar-text navbar-center" style="position: absolute; float: left; width: 100%; text-align: center;">
						{{active_module.name}}
					</div>
					<ul class="nav navbar-nav">
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button">Module<span class="caret"></span></a>
							<ul class="dropdown-menu">
								<li ng-repeat="module in modules"><a ng-click="selectModule(module);" href="#">{{module.name}}</a></li>
							</ul>
						</li>
					</ul>
					<ul class="nav navbar-right">
						<li>
							<a href="/about.html" class="btn btn-default navbar-btn">About</a>
						</li>
					</ul>
				</div>
			</nav>
		
			<div class="row">
				<div class="col-sm-3 panel-group pre-scrollable" style="max-height: {{(height)}}px;">
					<div class="panel panel-info">
						<div class="panel-body" id="peripherals">

							<div ng-repeat="peripheral in core.peripherals" class="panel">

								<div class="panel-heading" style="padding: 0.5em; background: {{peripheral.color}};">
									<select ng-if="(peripheral.name != 'GPIO') && (! peripheral.disabled) && (! active_module.peripherals[peripheral.name].disabled)" ng-model="peripheral.active_mode" class="mode-selector">
										<option ng-repeat="(modename, modepins) in peripheral.modes" value="{{modename}}">{{modename}}</option>
									</select>
									<div class="panel-title collapsed" data-toggle="collapse" href="#collapse{{peripheral.name}}">
										<span>
											{{peripheral.name}}
										</span>
									</div>
								</div>
								<div class="panel-collapse collapse" id="collapse{{peripheral.name}}">
									<div ng-if="(peripheral.description) || (active_module.peripherals[peripheral.name])" class="panel panel-default">
										<div class="panel-heading">
											<div class="panel-title-description collapsed" data-toggle="collapse" href="#collapse-description{{peripheral.name}}">
												Description
											</div>
										</div>
										<div class="panel-collapse collapse" id="collapse-description{{peripheral.name}}">
											<p>
												{{peripheral.description}}
											</p>
											<p ng-if="active_module.peripherals[peripheral.name]">
												{{active_module.peripherals[peripheral.name].description}}
											</p>
										</div>
									</div>
									
									<div ng-if="(peripheral.name != 'GPIO') && (! peripheral.disabled)" class="panel panel-default">
										<div class="panel-body">
											<div ng-repeat="(pinname, pinnums) in peripheral.pins" style="background: {{($even ? 'white' : 'lightgrey')}};">
												<div ng-if="peripheral.modes[peripheral.active_mode].indexOf(pinname) >= 0">
													<span class="pin-name">
														{{pinname}}
													</span>
													<span ng-if="pinnums.length == 1">
														{{(pinnums[0] ? active_module.pin_map[pinnums[0]] : "---")}}
													</span>
													<button ng-if="(pinnums.length == 2) && (pinnums[0] == null)" ng-click="(peripheral.active_pins[pinname] ? peripheral.active_pins[pinname] = null : peripheral.active_pins[pinname] = pinnums[1])" ng-disabled="peripheral.active_mode == 'OFF'" class="btn label {{(peripheral.active_pins[pinname] ? 'label-success' : 'label-default')}} selector">
														{{(peripheral.active_pins[pinname] ? "ON" : "OFF")}}
													</button>
													<select ng-if="((pinnums.length == 2) && (pinnums[0] != null)) || (pinnums.length > 2)" ng-model="peripheral.active_pins[pinname]" convert-to-number ng-disabled="peripheral.active_mode == 'OFF'" class="selector">
														<option ng-repeat="num in pinnums" ng-if="(num == null) || (active_module.pin_map[num] != null)" value="{{num}}">{{(num ? active_module.pin_map[num] : "---")}}</option>
													</select>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							
						</div>
					</div>
				</div>
				<div class="col-sm-9" id="module">
				
					<div class="panel panel-default" ng-show="selected_pin" style="width: {{active_module.width}}%; left: {{((100 - active_module.width) / 2)}}%; top: 100px; position: absolute;">
						<div class="panel-heading" ng-click="selectPin(null);">
							{{selected_pin.name}}
						</div>
						<div class="panel-body">
							<span ng-if="selected_pin.number">
								<h5>Core name: {{core.pinout[selected_pin.number - 1].name}}</h5>
								<p>
									{{core.pinout[selected_pin.number - 1].description}}
								</p>
								<p>
									Input: {{core.pinout[selected_pin.number - 1].input}}
								</p>
								<p>
									Output: {{core.pinout[selected_pin.number - 1].output}}
								</p>
								<p>
									PWM: {{core.pinout[selected_pin.number - 1].pwm}}
								</p>
							</span>
							<p ng-if="selected_pin.description">
								{{selected_pin.description}}
							</p>
						</div>
					</div>
					
					<img src="{{active_module.image}}" class="module-image" style="width: {{active_module.width}}%;"></img>
					
					<div ng-repeat="pin in active_module.pins" class="label-pin-{{pin.side}}" style="top: {{pin.position}}%; left: {{(pin.side == 'left' ? 0 : (100 - ((100 - active_module.width) / 2)))}}%; width: {{((100 - active_module.width) / 2)}}%;">
					
						<button ng-if="pin.side == 'right'" ng-click="selectPin(pin);" class="badge btn" style="background-color: {{pin.color}};">
							{{pin.name}}
						</button>
						
						<div ng-if="pin.number != null" ng-repeat="peripheral in core.peripherals" style="display:inline-block;">
							<div ng-repeat="peripinname in peripheral.modes[peripheral.active_mode]">
								<span ng-if="(peripheral.active_pins[peripinname] == pin.number) && (peripheral.active_mode != 'OFF')" class="label" style="background: {{peripheral.color}};">
									{{peripinname}}
								</span>
							</div>
						</div>
						
						<div ng-if="pin.side == 'left'" ng-click="selectPin(pin);" class="badge btn" style="background-color: {{pin.color}};">
							{{pin.name}}
						</div>
					</div>
				
				</div>
			</div>
		
		</div>
		
		<script data-main="config" src="lib/require.js"></script>
	
	</body>
</html>

